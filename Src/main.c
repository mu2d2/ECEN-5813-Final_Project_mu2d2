/**
 ******************************************************************************
 * @file           : main.c
 * @author         : Auto-generated by STM32CubeIDE
 * @brief          : Main program body
 ******************************************************************************
 * @attention
 *
 * Copyright (c) 2023 STMicroelectronics.
 * All rights reserved.
 *
 * This software is licensed under terms that can be found in the LICENSE file
 * in the root directory of this software component.
 * If no LICENSE file comes with this software, it is provided AS-IS.
 *
 ******************************************************************************
 */
#include "pwm.h"//servo and uled control
#include "adc.h"//adc control
#include "timers.h"//timing 
#include "state_machine.h"//state_machine control of Application
#include "log.h"//debug 

int main(void)
{
	/* You can use the Command Shell Console in STM32CubeIDE or an
	 * external program such as Putty or TeraTerm to view printf output.
	 * The settings are: Baud: 9600, Parity: None, Stop Bits: 1 with
	 * the ST-Link COM port setting.
	 * Clocks: Processor = 48 Mhz. AHB = 48 MHz. APB = 24 MHz.
	 */
	LOG("Hello World !\r\n");

	/* Initialization */
	init_uled();
	init_PWM_SERVO();
	init_systick();
	set_uled(OFF);
	
    /* Loop forever */
	LOG("Main Loop Starting\r\n");
	reset_timer(TIMER_START_ID);//starts timer
	reset_timer(TIMER_START_ULED_ID);//starts timer
	uint8_t blink = 0, test = 0;
	ticktime_t local_timer = 0;
	for(;;)
	{
		local_timer = get_timer(TIMER_START_ULED_ID);
		if(local_timer >= ONE_SECOND_TICKS)//1second interrupt
		{
			blink = !blink;//toggle uled flag
			reset_timer(TIMER_START_ULED_ID);//reset timer reference
			set_uled(blink);//toggle uled flag
		}
		if(!test)
		{
			servo_set_angle(270);
			test = !test;
		}
	}
}
